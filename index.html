<!DOCTYPE html>
<html lang="en">
<!-- Graphics town framework code by Mike Gleicher
  -- written October, 2015
  -->
<head>
<meta charset="UTF-8">
<title>Pokemon Town!</title>
</head>
<body style="margin: 0px; background: linear-gradient(to bottom right, #7e96bc, #0a1f3f);">
	<!-- load this stuff first -->
	<script src="Libraries/twgl-full.js"></script>
	<script src="Libraries/panel.js"></script>
	<script src="Libraries/arcball.js"></script>
	<script src="Libraries/shapes.js"></script>
	<script src="grobject.js"></script>

	<!-- This is where we load the objects for the world -->
    <script src="Objects/ground.js"></script>
	<script src="Objects/pokeball.js"></script>
	<script src="Objects/weedle.js"></script>
	<script src="Objects/sun.js"></script>
	<script src="Objects/moon.js"></script>

	<!-- This gets loaded LAST (actually, it probably doesn't have to) -->
	<script src="graphicstown.js"></script>
</body>

<script id="vs" type="notjs">
    precision highp float;
    uniform float isPokeball; //cut off part of pokeball
    uniform float isSun; //give extra light
    uniform float isMoon; //give extra light
    uniform mat4 view;
    uniform mat4 proj;
    uniform mat4 model;
    uniform vec3 lightDir;
    uniform vec3 cubeColor;
    uniform mat4 normalMatrix; 
    attribute vec3 vPos;
    attribute vec3 vNormal;
    attribute vec3 inColor;

    varying vec3 outColor;
    varying vec3 fPos;
    varying vec3 fNormal;
    varying vec3 normalInterp;

    void main(void) {
        fNormal = normalize(mat3(normalMatrix) * vNormal);
        gl_Position = proj * view * model * vec4(vPos, 1.0);
        fPos = vPos;
        outColor = inColor;
    }
</script>
<script id="fs" type="notjs">
    precision highp float;
    uniform float isPokeball; //cut off part of pokeball
    uniform float isSun; //give extra light   
    uniform float isMoon; //give extra light 
    uniform mat4 view;
    uniform mat4 proj;
    uniform mat4 model;
    uniform vec3 lightDir;
    uniform mat4 normalMatrix;

    varying vec3 outColor;
    varying vec3 fPos;
    varying vec3 fNormal;
    varying vec3 normalInterp;

    float Ka = 0.3;
    float Kd = 0.4;
    float Ks = 1.5;
    float sExp = 100.0;
    vec3 lightCol = vec3(1.0,1.0,1.0);

    void main(void) {
      if (isPokeball == 1.0 && (outColor.x >= 0.99) && fPos.z < -0.51) //cut out pokeball
        discard;
      else if (isSun == 1.0)
        Ka += 0.9;
      else if (isMoon == 1.0)
        Ka += 0.5;      

      vec3 lightDir2 = lightDir;    

      if (lightDir[1] < 0.0) {  //night time
        lightDir2 = vec3(-lightDir[0], -lightDir[1], -lightDir[2]);
        Ka = 0.05;
        Kd = 0.2;
	    lightCol = vec3(0.1, 0.1, 0.1);
      }

      vec3 l=normalize(-lightDir2-fPos);
      vec3 n=normalize(fNormal);
      vec3 e=normalize(-fPos);
      vec3 h=normalize(e+l);

      Ka *= abs(lightDir2[1]/100.0);
      Kd *= abs(lightDir2[1]/100.0);
      Ks *= abs(lightDir2[1]/100.0);

      vec3 ambientColor = Ka*outColor;
      vec3 diffuseColor = Kd*outColor*dot(l,n);
      vec3 specularColor = Ks*lightCol*pow(max(dot(h,n),0.0),sExp);

      gl_FragColor = vec4(ambientColor+diffuseColor+specularColor, 1.0);
    }
</script>

</html>