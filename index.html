<!DOCTYPE html>
<html lang="en">
<!-- Graphics town framework code by Mike Gleicher
  -- written October, 2015
  -->
<head>
<meta charset="UTF-8">
<title>Pokemon Town!</title>
</head>
<body style="margin: 0px; background: linear-gradient(to bottom right, #7e96bc, #0a1f3f);">
	<!-- load this stuff first -->
	<script src="Libraries/twgl-full.js"></script>
	<script src="Libraries/panel.js"></script>
	<script src="Libraries/arcball.js"></script>
	<script src="Libraries/shapes.js"></script>
	<script src="grobject.js"></script>
	<script src="Objects/ground.js"></script>
	<!-- <script src="ExampleObjects/ground.js"></script> -->

	<!-- This is where we load the objects for the world -->
	<script src="Objects/pokeball.js"></script>
	<!-- <script src="ExampleObjects/simplest.js"></script> -->
	<!-- <script src="ExampleObjects/texturedplane.js"></script> -->
	<!-- <script src="ExampleObjects/cube.js"></script> -->

	<!-- <!-- I am adding the helicopter -->
	<!-- <script src="Helicopter/helicopter.js"></script> -->

	<!-- This gets loaded LAST (actually, it probably doesn't have to) -->
	<script src="graphicstown.js"></script>
</body>

<!-- all of the shaders get stuck here in the HTML because
  -- that's the only way I know to load them without either
  -- sticking them in JavaScript strings, or using a web server
  -->

<script id="vs" type="notjs">
    precision highp float;
    uniform float isPokeball;
    uniform mat4 view;
    uniform mat4 proj;
    uniform mat4 model;
    uniform vec3 lightDir;
    uniform vec3 cubeColor;
    uniform mat4 normalMatrix; 
    attribute vec3 vPos;
    attribute vec3 vNormal;
    attribute vec3 inColor;

    varying vec3 outColor;
    varying vec3 fPos;
    varying vec3 fNormal;

    void main(void) {
        fNormal = normalize(mat3(normalMatrix) * vNormal);
        gl_Position = proj * view * model * vec4(vPos, 1.0);
        fPos = vPos;
        outColor = inColor;
    }
</script>
<script id="fs" type="notjs">
    precision highp float;
    uniform float isPokeball;
    uniform vec3 lightDir;

    varying vec3 outColor;
    varying vec3 fPos;
    varying vec3 fNormal;

    float Ka = 0.3;
    float Kd = 0.4;
    float Ks = 0.0;
    float sExp = 10.0;
    vec3 lightCol = vec3(1.0,1.0,1.0);

    void main(void) {
      if (isPokeball == 1.0 && (outColor.x >= 0.99) && fPos.z < -0.51) //cut out pokeball
        discard;
    
      vec3 l=normalize(-lightDir-fPos);
      vec3 n=normalize(fNormal);
      vec3 e=normalize(-fPos);
      vec3 h=normalize(e+l);

      if (lightDir[1] < 0.0) { //night time
        l = normalize(lightDir-fPos);
        Ka = 0.01;
        Kd = 0.1;
	    lightCol = vec3(0.1, 0.1, 0.1);
      }
      Ka *= abs(lightDir[1]/10.0);
      Kd *= abs(lightDir[1]/10.0);

      vec3 ambientColor = Ka*outColor;
      vec3 diffuseColor = Kd*outColor*dot(l,n);
      vec3 specularColor = Ks*lightCol*pow(max(dot(h,n),0.0),sExp);

      gl_FragColor = vec4(ambientColor+diffuseColor+specularColor, 1.0);

    }
</script>

</html>